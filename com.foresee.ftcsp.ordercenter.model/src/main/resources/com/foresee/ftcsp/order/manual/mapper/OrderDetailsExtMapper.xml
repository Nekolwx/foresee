<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.foresee.ftcsp.order.manual.dao.OrderDetailsExtMapper">
	<resultMap id="BaseResultMap"
		type="com.foresee.ftcsp.order.manual.dto.OrdOrderDTO">
		<!-- @MBG Generated This element is automatically generated by MyBatis 
			Generator,Do not modify ! Generated on Thu Aug 17 10:48:48 CST 2017. -->
		<id column="order_id" jdbcType="BIGINT" property="orderId" />
		<result column="order_code" jdbcType="VARCHAR" property="orderCode" />
		<result column="order_type" jdbcType="INTEGER" property="orderType" />
		<result column="root_order_id" jdbcType="BIGINT" property="rootOrderId" />
		<result column="order_status" jdbcType="INTEGER" property="orderStatus" />
		<result column="order_time" jdbcType="TIMESTAMP" property="orderTime" />
		<result column="order_user" jdbcType="VARCHAR" property="orderUser" />
		<result column="divide_pay" jdbcType="INTEGER" property="dividePay" />
		<result column="sku_id" jdbcType="BIGINT" property="skuId" />
		<result column="goods_id" jdbcType="BIGINT" property="goodsId" />
		<result column="product_id" jdbcType="BIGINT" property="productId" />
		<result column="customer_id" jdbcType="VARCHAR" property="customerId" />
		<result column="area_code" jdbcType="VARCHAR" property="areaCode" />
		<result column="sales_person" jdbcType="VARCHAR" property="salesPerson" />
		<result column="billing_status" jdbcType="INTEGER" property="billingStatus" />
		<result column="goods_original_price" jdbcType="DECIMAL"
			property="goodsOriginalPrice" />
		<result column="goods_quantity" jdbcType="INTEGER" property="goodsQuantity" />
		<result column="goods_amount" jdbcType="DECIMAL" property="goodsAmount" />
		<result column="freight" jdbcType="DECIMAL" property="freight" />
		<result column="discount_amount" jdbcType="DECIMAL" property="discountAmount" />
		<result column="pay_amount" jdbcType="DECIMAL" property="payAmount" />
		<result column="channel" jdbcType="INTEGER" property="channel" />
		<result column="service_start_date" jdbcType="TIMESTAMP"
			property="serviceStartDate" />
		<result column="service_end_date" jdbcType="TIMESTAMP"
			property="serviceEndDate" />
		<result column="business_order_no" jdbcType="VARCHAR" property="businessOrderNo" />
		<result column="operation_center_id" jdbcType="VARCHAR"
			property="operationCenterId" />
		<result column="store_id" jdbcType="VARCHAR" property="storeId" />
		<result column="factory_id" jdbcType="VARCHAR" property="factoryId" />
		<result column="feedback" jdbcType="VARCHAR" property="feedback" />
		<result column="billing_info_id" jdbcType="BIGINT" property="billingInfoId" />
		<result column="is_delivery" jdbcType="INTEGER" property="isDelivery" />
		<result column="pay_status" jdbcType="INTEGER" property="payStatus" />
		<result column="refund_status" jdbcType="INTEGER" property="refundStatus" />
		<result column="service_status" jdbcType="INTEGER" property="serviceStatus" />
		<result column="logistics_status" jdbcType="INTEGER" property="logisticsStatus" />
		<result column="deleted" jdbcType="INTEGER" property="deleted" />
		<result column="is_parent" jdbcType="INTEGER" property="isParent" />
		<result column="parent_id" jdbcType="BIGINT" property="parentId" />
		<result column="create_user" jdbcType="VARCHAR" property="createUser" />
		<result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
		<result column="update_user" jdbcType="VARCHAR" property="updateUser" />
		<result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- @MBG Generated This element is automatically generated by MyBatis 
			Generator,Do not modify ! Generated on Thu Aug 17 10:48:48 CST 2017. -->
		order_id, order_code, order_type, root_order_id, order_status,
		order_time, order_user,
		divide_pay, sku_id, goods_id, product_id,
		customer_id, area_code, sales_person,
		billing_status,
		goods_original_price, goods_quantity, goods_amount, freight,
		discount_amount, pay_amount,
		channel, service_start_date,
		service_end_date, business_order_no,
		operation_center_id,
		store_id,
		factory_id, feedback, billing_info_id, is_delivery, pay_status,
		refund_status,
		service_status, logistics_status, deleted, is_parent,
		parent_id, create_user,
		create_time,
		update_user, update_time
	</sql>

	<select id="queryOrderByOrderId" parameterType="Long"
		resultType="com.foresee.ftcsp.order.manual.dto.OrdOrderDTO">
		SELECT
		o.goods_id,
		o.customer_id,
		o.order_user,
		o.contact_phone AS mobilePhone,
		o.area_code,
		d.delivery_mode AS deliveryMode,
		d.receiver_address,
		d.invite_address,
		o.order_status,
		o.service_status,
		o.logistics_status,
		o.is_parent,
		o.parent_id,
		o.sku_id,
		o.goods_original_price,
		o.goods_quantity,
		o.area_code,
		o.order_id, 
		o.order_code,
		o.order_time,
		DATE_FORMAT(o.order_time,'%Y-%m-%d %T') AS orderTimeStr,
		o.freight,
		o.discount_amount,
		o.goods_amount,
		o.pay_status,
		o.pay_amount,
		o.channel,
		o.is_delivery,
		o.contract_charging_start_time,
		o.contract_charging_end_time,
		o.service_start_date,
		o.service_end_date
		FROM
		ftcsp_order.t_ord_order o
		left join
		ftcsp_order.t_ord_delivery d on d.order_id=o.order_id
		WHERE
		o.order_id =#{orderId,jdbcType=BIGINT}
	</select>
	
	<select id="queryOrderByParentId" parameterType="Long"
		resultType="Long">
		SELECT
		o.order_id
		FROM
		ftcsp_order.t_ord_order o
		WHERE
		o.parent_id =#{parentId,jdbcType=VARCHAR}
	</select>
	
	<select id="queryOrdBillItem" parameterType="Long"
		resultType="com.foresee.ftcsp.order.manual.dto.OrdBillItemDTO">
		SELECT
		i.bill_id,
		i.item_type,
		i.item_name,
		i.unit,
		i.spec,
		i.qty,
		i.price,
		i.amount,
		o.goods_amount,
		o.freight,
		o.discount_amount,
		o.order_code,
		o.order_status,
		o.service_status,
		o.pay_status,
		o.sku_id,
		o.pay_amount,
		o.order_id,		
		g.goods_code AS goodsCode,
		g.goods_name AS goodsName	
		FROM
		ftcsp_order.t_ord_order o
		LEFT JOIN ftcsp_pdt.t_pdt_goods g ON o.goods_id=g.goods_id
		LEFT JOIN ftcsp_order.t_ord_bill b ON b.order_id = o.order_id
		LEFT JOIN ftcsp_order.t_ord_bill_item i ON b.bill_id=i.bill_id	
		WHERE		
		o.order_id =#{orderId,jdbcType=VARCHAR}
	</select>
    
</mapper>